(function(e,t,n){"use strict";var r=t.module("ngDialog",[]);var i=t.element;var s=t.isDefined;var o=(document.body||document.documentElement).style;var u=s(o.animation)||s(o.WebkitAnimation)||s(o.MozAnimation)||s(o.MsAnimation)||s(o.OAnimation);var a="animationend webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend";r.provider("ngDialog",function(){var n=this.defaults={className:"ngdialog-theme-default",plain:false,showClose:true,closeByDocument:true,closeByEscape:true};var r=0,s=0,o,f={};this.$get=["$document","$templateCache","$compile","$q","$http","$rootScope","$timeout",function(l,c,h,p,d,v,m){var g=l.find("body");var y={onDocumentKeydown:function(e){if(e.keyCode===27){b.close()}},closeDialog:function(t){var n=t.attr("id");if(typeof e.Hammer!=="undefined"){e.Hammer(t[0]).off("tap",o)}else{t.unbind("click")}if(s===1){g.unbind("keydown")}if(!t.hasClass("ngdialog-closing")){s-=1}if(u){t.unbind(a).bind(a,function(){t.scope().$destroy();t.remove();if(s===0){g.removeClass("ngdialog-open")}}).addClass("ngdialog-closing")}else{t.scope().$destroy();t.remove();if(s===0){g.removeClass("ngdialog-open")}}if(f[n]){f[n].resolve({id:n,$dialog:t,remainingDialogs:s});delete f[n]}v.$broadcast("ngDialog.closed",t)}};var b={open:function(u){function x(e){if(!e){return"Empty template"}if(t.isString(e)&&l.plain){return e}return c.get(e)||d.get(e,{cache:true})}var a=this;var l=t.copy(n);u=u||{};t.extend(l,u);r+=1;a.latestID="ngdialog"+r;var w;f[a.latestID]=w=p.defer();var E=t.isObject(l.scope)?l.scope.$new():v.$new();var S;p.when(x(l.template)).then(function(n){n=t.isString(n)?n:n.data&&t.isString(n.data)?n.data:"";c.put(l.template,n);if(l.showClose){n+='<div class="ngdialog-close"></div>'}a.$result=S=i('<div id="ngdialog'+r+'" class="ngdialog-wrapper"></div>');S.html('<div class="ngdialog-overlay"></div><div class="ngdialog"><div class="ngdialog-content">'+n+"</div></div>");if(l.controller&&t.isString(l.controller)){S.attr("ng-controller",l.controller)}if(l.className){S.addClass(l.className)}if(l.data&&t.isString(l.data)){E.ngDialogData=l.data.replace(/^\s*/,"")[0]==="{"?t.fromJson(l.data):l.data}E.closeThisDialog=function(){y.closeDialog(S)};m(function(){h(S)(E);g.addClass("ngdialog-open").append(S)});if(l.closeByEscape){g.bind("keydown",y.onDocumentKeydown)}o=function(e){var t=l.closeByDocument?i(e.target).hasClass("ngdialog"):false;var n=i(e.target).hasClass("ngdialog-close");if(t||n){b.close(S.attr("id"))}};if(typeof e.Hammer!=="undefined"){e.Hammer(S[0]).on("tap",o)}else{S.bind("click",o)}s+=1;v.$broadcast("ngDialog.opened",S);return b});return{id:"ngdialog"+r,closePromise:w.promise,close:function(){y.closeDialog(S)}}},openConfirm:function(e){var n=p.defer();var r={closeByEscape:false,closeByDocument:false};t.extend(r,e);r.scope=t.isObject(r.scope)?r.scope.$new():v.$new();r.scope.confirm=function(e){n.resolve(e);i.close()};var i=b.open(r);i.closePromise.then(function(){n.reject()});return n.promise},close:function(e){var t=i(document.getElementById(e));if(t.length){y.closeDialog(t)}else{b.closeAll()}return b},closeAll:function(){var e=document.querySelectorAll(".ngdialog-wrapper");t.forEach(e,function(e){y.closeDialog(i(e))})}};return b}]});r.directive("ngDialog",["ngDialog",function(e){return{restrict:"A",scope:{ngDialogScope:"="},link:function(n,r,i){r.on("click",function(r){r.preventDefault();var s=t.isDefined(n.ngDialogScope)?n.ngDialogScope:"noScope";t.isDefined(i.ngDialogClosePrevious)&&e.close(i.ngDialogClosePrevious);e.open({template:i.ngDialog,className:i.ngDialogClass,controller:i.ngDialogController,scope:s,data:i.ngDialogData,showClose:i.ngDialogShowClose==="false"?false:true,closeByDocument:i.ngDialogCloseByDocument==="false"?false:true,closeByEscape:i.ngDialogCloseByEscape==="false"?false:true})})}}}])})(window,window.angular)
